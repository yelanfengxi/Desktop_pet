
# 【阶段二】测试指南

## 一、概述
本阶段已成功集成 PixiJS 渲染引擎，实现了占位模型渲染和基础视线跟随功能。由于 Live2D 专用 SDK 包的兼容性问题，我们先实现了基础的 PixiJS 渲染架构，为后续集成完整 Live2D 功能奠定了基础。

## 二、已完成的功能

### 2.1 PixiJS 渲染引擎集成
- 成功初始化 PixiJS 应用
- 配置透明背景渲染
- 实现自适应画布尺寸

### 2.2 占位模型渲染
- 创建了一个包含主体和眼睛的圆形占位模型
- 用于演示基础渲染和视线跟随功能

### 2.3 视线跟随功能
- 实现鼠标位置追踪
- 计算归一化的鼠标坐标
- 实现眼睛跟随鼠标移动的功能

### 2.4 保留阶段一功能
- 完整保留窗口拖拽功能
- 保留透明区域鼠标穿透特性
- 保留窗口置顶和无边框特性

## 三、文件变更清单

### 3.1 新增文件
- `src/renderer/pet/live2d-adapter.js`：Live2D 适配器框架（预留接口）
- `TEST_GUIDE_PHASE2.md`：本测试指南

### 3.2 修改文件
- `src/renderer/pet/index.html`：移除 img 元素，添加容器支持
- `src/renderer/pet/pet-app.js`：集成 PixiJS 和实现视线跟随

## 四、测试步骤

### 4.1 启动应用
1. 确保终端在项目根目录 `d:\WORKS\LAN` 下
2. 执行命令：
```bash
npm start
```

### 4.2 验证要点

#### 要点 1：PixiJS 渲染验证
- [ ] 窗口中是否显示一个粉红色圆形模型
- [ ] 圆形模型中是否有两个黑色的眼睛
- [ ] 背景是否完全透明

#### 要点 2：视线跟随功能验证
- [ ] 当鼠标在窗口内移动时，眼睛是否跟随移动
- [ ] 眼睛移动是否平滑自然
- [ ] 眼睛移动范围是否合理（不会超出模型边界）

#### 要点 3：阶段一功能保留验证
- [ ] 按住鼠标左键是否能拖动窗口
- [ ] 鼠标在透明区域是否能穿透点击
- [ ] 鼠标悬停在模型上时是否能响应事件
- [ ] 窗口是否保持始终置顶

## 五、下一阶段计划

### 5.1 解决 Live2D SDK 兼容性
- 研究并选择合适的 Live2D Web SDK
- 解决 npm 包兼容性问题
- 实现完整的 Live2D 模型加载

### 5.2 集成真实 Live2D 模型
- 加载项目中的 Live2D 模型资源
- 实现模型参数控制
- 实现完整的眼睛和头部跟随功能

### 5.3 优化用户体验
- 添加平滑过渡动画
- 优化性能
- 增加更多交互效果

## 六、常见问题

### Q1：为什么只显示占位模型而不是真实 Live2D 模型？
A：由于 @pixi/live2d-display 包在官方 npm 源中不可用，我们需要先解决 Live2D SDK 的集成问题。当前的占位模型用于验证基础架构和视线跟随逻辑。

### Q2：如何添加真实的 Live2D SDK？
A：有几个方案：
1. 使用官方 Live2D Cubism Web SDK
2. 使用社区维护的 Live2D 实现
3. 自行实现基于 Live2D 规范的渲染器

### Q3：当前阶段的代码可以用于下一阶段吗？
A：可以！当前的代码架构已经为 Live2D 集成预留了接口和框架，下一阶段只需要替换占位模型部分即可。

## 七、技术说明

### 7.1 视线跟随算法原理
当前实现使用简单的线性映射算法：
1. 获取鼠标在容器内的坐标
2. 将坐标归一化到 [-0.5, 0.5] 范围
3. 乘以移动范围系数限制眼睛移动范围
4. 直接设置眼睛的位置偏移

### 7.2 坐标系统说明
- 窗口坐标系：左上角为原点 (0,0)
- 归一化坐标系：中心点为原点 (0,0)，范围 [-0.5, 0.5]
- 眼睛移动范围：受 eyeMoveRange 参数控制

## 八、注意事项

1. 确保 Node.js 和 npm 环境正常
2. 确保已安装所有依赖包
3. 首次启动可能需要几秒钟时间初始化
4. 如果遇到问题，请查看开发者工具的控制台输出
