# 项目需求文档 (PRD): AI 桌面宠物伴侣
**更新日期**: 2026-02-21

## 1. 项目概述
本项目旨在开发一款基于 Electron 的桌面宠物应用。该应用将在 Windows 系统桌面上生成一个透明、无边框的常驻角色（支持静态/动态图片及 Live2D 模型）。核心特色是集成大语言视觉模型（Vision LLM）与语音合成技术（VOICEVOX），实现桌宠对用户屏幕状态的感知与语音互动。

## 2. 系统提示与开发纪律（AI 开发者必读）
- **核心框架**：使用 Electron 构建主进程与渲染进程。使用纯前端技术（HTML/CSS/JS）结合 PixiJS 和 Live2D Cubism Web SDK 渲染模型。
- **环境限制**：仅针对 Windows 11 环境进行适配和测试，暂不考虑 Linux/macOS 的兼容性。
- **代码规范**：所有变量名、函数名必须使用标准的英文小驼峰/大驼峰命名法。
- **注释要求**：必须为所有核心逻辑、复杂算法、Electron IPC 通信、API 调用提供**非常详细的中文注释**，以确保基础较弱的开发者能够完全读懂代码的作用和使用方法。
- **渐进式开发**：禁止一次性生成数百行代码。必须分模块、分步骤进行开发和测试。

## 3. 核心功能需求

### 3.1 角色渲染与显示 (UI/视觉)
- **支持双模式显示**：
  - **图片模式**：支持读取本地文件夹中的静态图片（PNG/JPG）或动态图（GIF/WebP）。支持根据状态（待机、说话）切换图片。
  - **Live2D 模式**：支持加载标准 Live2D 模型文件（`.model.json` / `.model3.json`）。包含基础的鼠标视线跟随功能。
- **窗口特性**：
  - 纯透明背景，无系统边框，始终置顶 (Always on top)。
  - **鼠标穿透与交互**：默认情况下，鼠标在桌宠透明区域可以穿透（点击到下层桌面）。当鼠标悬停在桌宠实体图像上时，可进行交互。

### 3.2 交互与动画
- **拖拽移动**：用户可以使用鼠标左键按住桌宠进行位置拖拽。
- **点击交互**：点击桌宠实体可唤出聊天气泡或设置菜单。
- **动作反馈**：拖拽时触发特定动画/图片，点击时触发相应反馈。

### 3.3 AI 视觉感知与对话引擎
- **屏幕截取**：应用能在后台定时或通过快捷键截取当前 Windows 主屏幕画面。
- **视觉分析与对话**：
  - 支持配置兼容 OpenAI 格式的 Vision API 接口（如 Grok-vision, GPT-4o, Gemini Pro Vision 等）。
  - 将屏幕截图与用户的系统级 Prompt 发送给大模型进行分析。
  - 接收模型返回的文本，在桌宠旁边的 UI 气泡中显示。
- **API 频率控制（必须实现）**：
  - 提供以下选项控制截图分析的间隔时间：手动触发、10 分钟/次、5 分钟/次、1 分钟/次、自定义时间（分钟）。
- **截图隐私与清理**：
  - 截图数据仅保存在内存或临时目录，发送完毕后必须立即销毁，不长期留存本地磁盘。

### 3.4 语音合成 (VOICEVOX)
- 集成 VOICEVOX 本地服务引擎。
- 将 AI 生成的对话文本（如需，可通过 LLM 翻译为日语）发送至本机的 VOICEVOX 服务。
- 接收音频流并与对话气泡同步播放。
- **容错机制**：若检测不到 VOICEVOX 环境或合成失败，自动静音，仅显示文字气泡，不阻塞主流程。

### 3.5 设置面板 (Settings UI)
提供一个独立的标准窗口用于配置，需包含以下核心设置项：
1. **模型配置**：选择本地 Live2D 文件夹或图片文件夹。
2. **API 基础配置**：填入 Base URL, API Key, 模型名称，系统预设 Prompt。
3. **API 高级配置**：
   - **最大回复长度 (Max Tokens)**：提供下拉菜单选项：1024、2048、3072、4096、自定义 Token 数量。
   - **视觉分析频率**：提供下拉菜单选项：手动触发、1分钟、5分钟、10分钟、自定义分钟数。
4. **TTS 配置**：VOICEVOX 角色/风格选择（如有接口支持）。

## 4. 阶段验收标准
- **阶段一**：成功创建一个完全透明的 Electron 窗口，并在其中渲染出一张静态图片，支持鼠标拖拽，透明区域鼠标穿透。
- **阶段二**：引入 Live2D SDK，能够成功加载任意标准 Live2D 模型，并实现基础的视线跟随。
- **阶段三**：实现 Electron 主进程截屏功能，打通 OpenAI 格式 API 进行图片上传和文字返回，并实现 Token 长度控制与定时/手动触发频率控制。
- **阶段四**：对接 VOICEVOX 接口，实现文字转语音播放。完善设置面板的所有交互逻辑。